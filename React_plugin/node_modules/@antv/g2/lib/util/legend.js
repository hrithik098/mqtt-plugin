"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var util_1 = require("@antv/util");
var constant_1 = require("../constant");
var attr_1 = require("./attr");
var marker_1 = require("./marker");
/**
 * @ignore
 * get the legend layout from direction
 * @param direction
 * @returns layout 'horizontal' | 'vertical'
 */
function getLegendLayout(direction) {
    return direction.startsWith(constant_1.DIRECTION.LEFT) || direction.startsWith(constant_1.DIRECTION.RIGHT) ? 'vertical' : 'horizontal';
}
exports.getLegendLayout = getLegendLayout;
/**
 * @ignore
 * get the legend items
 * @param view
 * @param geometry
 * @param attr
 * @param themeMarker
 * @param userMarker
 * @returns legend items
 */
function getLegendItems(view, geometry, attr, themeMarker, userMarker) {
    var scale = attr.getScale(attr.type);
    if (scale.isCategory) {
        var field_1 = scale.field;
        return util_1.map(scale.getTicks(), function (tick) {
            var _a;
            var text = tick.text, scaleValue = tick.value;
            var name = text;
            var value = scale.invert(scaleValue);
            // 通过过滤图例项的数据，来看是否乣 unchecked
            var unchecked = !util_1.size(view.filterFieldData(field_1, [(_a = {}, _a[field_1] = value, _a)]));
            var colorAttr = geometry.getAttribute('color');
            var shapeAttr = geometry.getAttribute('shape');
            // @ts-ignore
            var color = attr_1.getMappingValue(colorAttr, value, view.getTheme().defaultColor);
            var shape = attr_1.getMappingValue(shapeAttr, value, 'point');
            var marker = geometry.getShapeMarker(shape, {
                color: color,
                isInPolar: geometry.coordinate.isPolar,
            });
            // the marker configure order should be ensure
            marker = util_1.deepMix({}, themeMarker, marker, userMarker);
            var symbol = marker.symbol;
            if (util_1.isString(symbol) && marker_1.MarkerSymbols[symbol]) {
                marker.symbol = marker_1.MarkerSymbols[symbol];
            }
            return { id: value, name: name, value: value, marker: marker, unchecked: unchecked };
        });
    }
    return [];
}
exports.getLegendItems = getLegendItems;
/**
 * @ignore
 * custom legend 的 items 获取
 * @param themeMarker
 * @param userMarker
 * @param customItems
 */
function getCustomLegendItems(themeMarker, userMarker, customItems) {
    // 如果有自定义的 item，那么就直接使用，并合并主题的 marker 配置
    return util_1.map(customItems, function (item) {
        var marker = util_1.deepMix({}, themeMarker, userMarker, item.marker);
        var symbol = marker.symbol;
        if (util_1.isString(symbol) && marker_1.MarkerSymbols[symbol]) {
            marker.symbol = marker_1.MarkerSymbols[symbol];
        }
        item.marker = marker;
        return item;
    });
}
exports.getCustomLegendItems = getCustomLegendItems;
//# sourceMappingURL=legend.js.map